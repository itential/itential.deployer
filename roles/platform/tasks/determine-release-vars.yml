# Copyright (c) 2024, Itential, Inc
# GNU General Public License v3.0+ (see LICENSE or https://www.gnu.org/licenses/gpl-3.0.txt)
---
- name: Determine release from the package name
  ansible.builtin.set_fact:
    platform_release: "{{ platform_package_name.split('_')[1] }}"
  when: platform_release is not defined

- name: Include release vars
  ansible.builtin.include_vars:
    file: "{{ item }}"
  with_first_found:
    - "{{ platform_release }}-{{ ansible_distribution | lower }}-{{ ansible_distribution_major_version }}.yml"
    - "release-undefined.yml"

- name: Check for valid Itential Platform release
  ansible.builtin.fail:
    msg: "Deployer installer does not support installing Itential Platform version {{ platform_release }} on {{ ansible_distribution | lower }}-{{ ansible_distribution_major_version }}"
  when: platform_invalid_release is defined
