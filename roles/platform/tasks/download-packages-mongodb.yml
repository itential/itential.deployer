# Copyright (c) 2024, Itential, Inc
# GNU General Public License v3.0+ (see LICENSE or https://www.gnu.org/licenses/gpl-3.0.txt)
---
- name: Download MongoDB RPMs
  when: platform_bootstrap_configs | bool
  block:
    - name: Install MongoDB repo
      ansible.builtin.yum_repository:
        name: "mongodb"
        description: MongoDB Repository
        baseurl: "{{ mongodb_release_url }}"
        enabled: true
        gpgcheck: true
        gpgkey: "{{ mongodb_gpgkey_url }}"
      when: install_yum_repos | bool

    - name: Download MongoDB RPMs
      ansible.builtin.import_role:
        name: offline
        tasks_from: download-rpms
      vars:
        offline_download_method: yum_module
        offline_download_packages: "{{ platform_mongodb_tools_packages }}"
        offline_download_dir: "{{ offline_rpms_download_dir_target_node }}"

    - name: Copy RPMs to control node
      ansible.builtin.import_role:
        name: offline
        tasks_from: fetch-packages
      vars:
        offline_src_dir: "{{ offline_rpms_download_dir_target_node }}"
        offline_dest_dir: "{{ offline_rpms_download_dir_control_node }}"
