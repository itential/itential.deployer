# -----------------------------------------------------
# This file is managed by Ansible.
# Safe to edit, but if you re-run automation, it may be overwritten.
#
# To customize retention, compression, or actions, edit below.

{{ redis_log_dir }}/redis.log {
    # How often to rotate (change to weekly/monthly if desired)
    daily

    # How many rotations to keep (increase/decrease as needed)
    rotate 7

    # Enable compression for old logs (can comment to disable)
    compress
    delaycompress

    # Don't complain if log is missing or empty
    missingok
    notifempty

    # Ensure logrotate runs with the right user/group
    su {{ redis_owner }} {{ redis_group }}

    # File permissions & ownership for new logs
    create 0640 {{ redis_owner }} {{ redis_group }}

    # Safest for Redis: copy+truncate the active file in place
    copytruncate

    # Ensures only one rotation at a time if multiple logs exist
    sharedscripts

    # NOTE: Redis does NOT reopen logs on HUP. Avoid postrotate/HUP.
}