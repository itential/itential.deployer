# MongoDB Installation Validation Report

- **Generated:** {{ ansible_date_time.iso8601 | default('Unknown') }}
- **Hostname:** {{ inventory_hostname | default('Unknown') }}
- **IP Address:** {{ ansible_default_ipv4.address | default('N/A') }}
- **OS:** {{ ansible_distribution | default('Unknown') }} {{ ansible_distribution_version | default('') }}

---

## Host Details

{% if host_details is defined %}
### Operating System
- **Distribution:** {{ host_details.os.distribution | default('Unknown') }} {{ host_details.os.distribution_version | default('') }}
- **OS Family:** {{ host_details.os.os_family | default('Unknown') }}
- **Kernel:** {{ host_details.os.kernel | default('Unknown') }}
- **Architecture:** {{ host_details.os.architecture | default('Unknown') }}
- **Hostname:** {{ host_details.os.hostname | default('Unknown') }}
- **FQDN:** {{ host_details.os.fqdn | default('Unknown') }}

### Hardware
- **CPU Count:** {{ host_details.hardware.cpu.processor_count | default('Unknown') }}
- **CPU Cores:** {{ host_details.hardware.cpu.processor_cores | default('Unknown') }}
- **CPU vCPUs:** {{ host_details.hardware.cpu.processor_vcpus | default('Unknown') }}
- **Threads per Core:** {{ host_details.hardware.cpu.processor_threads_per_core | default('Unknown') }}
- **Total Memory:** {{ host_details.hardware.memory.memtotal_mb | default('Unknown') }} MB
- **Free Memory:** {{ host_details.hardware.memory.memfree_mb | default('Unknown') }} MB
- **Swap Total:** {{ host_details.hardware.memory.swaptotal_mb | default('Unknown') }} MB

### Disk Mounts
{% if host_details.hardware.disk is defined and host_details.hardware.disk | length > 0 %}
{% for disk in host_details.hardware.disk %}
- **{{ disk.mount }}:** {{ disk.size_gb }} GB
{% endfor %}
{% else %}
- No disk information available
{% endif %}

### Networking
- **Primary IP:** {{ host_details.networking.default_ipv4.address | default('N/A') }}
- **Gateway:** {{ host_details.networking.default_ipv4.gateway | default('N/A') }}
- **Interface:** {{ host_details.networking.default_ipv4.interface | default('N/A') }}
- **MAC Address:** {{ host_details.networking.default_ipv4.macaddress | default('N/A') }}

### Security
{% if host_details.security.selinux is defined %}
- **SELinux Status:** {{ host_details.security.selinux.status | default('Unknown') }}
- **SELinux Mode:** {{ host_details.security.selinux.mode | default('Unknown') }}
- **SELinux Type:** {{ host_details.security.selinux.type | default('Unknown') }}
{% endif %}
{% if host_details.security.firewalld is defined %}
- **Firewalld:** {{ host_details.security.firewalld.state | default('Unknown') }}
{% endif %}
{% else %}
Host details not available
{% endif %}

---

## Service Status

{% if mongodb_service_status is defined and mongodb_service_status.status is defined %}
- **Service Name:** {{ mongodb_service_status.name | default('Unknown') }}
- **Service State:** {{ mongodb_service_status.status.ActiveState | default('Unknown') }}
- **Service SubState:** {{ mongodb_service_status.status.SubState | default('Unknown') }}
- **Service Enabled:** {{ mongodb_service_status.status.UnitFileState | default('Unknown') }}
{% else %}
- **Service Status:** Could not determine (service may not exist)
{% endif %}

**Process Running:** {{ 'YES ✓' if (mongodb_process is defined and mongodb_process.rc == 0) else 'NO ✗' }}

{% if mongodb_process is defined and mongodb_process.rc == 0 %}
**Process Details:**
```
{{ mongodb_process.stdout | default('N/A') }}
```
{% endif %}

---

## Connectivity

**Connection Tests:**
- **No Auth:** {{ 'SUCCESS ✓' if (mongodb_ping_noauth is defined and mongodb_ping_noauth.rc == 0) else 'FAILED ✗' }}
- **Admin User:** {{ 'SUCCESS ✓' if (mongodb_ping_admin is defined and mongodb_ping_admin.rc == 0) else 'FAILED ✗' }}
{% if mongodb_tls_mode.rc == 0 %}
- **TLS Connection:** {{ 'SUCCESS ✓' if (mongodb_ping_tls is defined and mongodb_ping_tls.rc == 0) else 'FAILED ✗' }}
{% endif %}

**Listening Ports:**
```
{{ mongodb_ports.stdout | default('Could not determine') if mongodb_ports is defined else 'Could not determine' }}
```

---

## Version Information

```
{{ mongodb_version.stdout | default('Version information not available') if mongodb_version is defined else 'Version information not available' }}
```

{% if mongodb_build_info is defined and mongodb_build_info.rc == 0 %}
**Build Details:**
{% set build = mongodb_build_info.stdout | from_json %}
- **Version:** {{ build.version | default('Unknown') }}
- **Git Version:** {{ build.gitVersion | default('Unknown') }}
- **OpenSSL Version:** {{ build.openssl.running | default('Unknown') }}
{% endif %}

---

## Configuration Files

- **Config File Exists:** {{ 'YES ✓' if (mongodb_conf_file is defined and mongodb_conf_file.stat.exists) else 'NO ✗' }}
{% if mongodb_conf_file is defined and mongodb_conf_file.stat.exists %}
- **Config File Path:** `/etc/mongod.conf`
- **Permissions:** {{ mongodb_conf_permissions.stdout | default('Unknown') if mongodb_conf_permissions is defined else 'Unknown' }}
{% endif %}

- **Systemd Unit File:** {{ 'YES ✓' if (mongodb_systemd_file is defined and mongodb_systemd_file.stat.exists) else 'NO ✗' }}
{% if mongodb_systemd_file is defined and mongodb_systemd_file.stat.exists %}
- **Unit File Path:** `/etc/systemd/system/mongod.service`
{% endif %}

---

## Data Directory

{% if mongodb_data_dir.stdout is defined and mongodb_data_dir.stdout != "" %}
- **Data Directory:** `{{ mongodb_data_dir.stdout }}`
- **Directory Exists:** {{ 'YES ✓' if (mongodb_data_dir_stat is defined and mongodb_data_dir_stat.stat.exists) else 'NO ✗' }}
{% if mongodb_data_size is defined and mongodb_data_size.rc == 0 %}
- **Data Size:** {{ mongodb_data_size.stdout }}
{% endif %}
{% else %}
Data directory not configured or could not be determined
{% endif %}

---

## Log Configuration

{% if mongodb_log_path.stdout is defined and mongodb_log_path.stdout != "" %}
- **Log Path:** `{{ mongodb_log_path.stdout }}`
{% else %}
Log path not configured or could not be determined (likely using journald)
{% endif %}

---

## Security Configuration

{% if mongodb_auth_enabled is defined and mongodb_auth_enabled.rc == 0 %}
- **Authentication:** ENABLED ✓
{% else %}
- **Authentication:** DISABLED ✗
{% endif %}

### TLS/SSL Configuration

{% if mongodb_tls_mode is defined and mongodb_tls_mode.rc == 0 %}
- **TLS Mode:** {{ mongodb_tls_mode.stdout | default('Not configured') }}
{% if mongodb_tls_cert_path.stdout is defined and mongodb_tls_cert_path.stdout != "" %}
- **Certificate Path:** `{{ mongodb_tls_cert_path.stdout }}`
- **Certificate Exists:** {{ 'YES ✓' if (mongodb_tls_cert_file is defined and mongodb_tls_cert_file.stat.exists) else 'NO' }}
{% if mongodb_tls_cert_expiry is defined and mongodb_tls_cert_expiry.rc == 0 %}
- **Certificate Expiration:** {{ mongodb_tls_cert_expiry.stdout }}
{% endif %}
{% endif %}
{% else %}
- **TLS:** Not configured ✗
{% endif %}

---

## User Authentication Tests

{% if mongodb_users is defined and mongodb_users | length > 0 %}
**Configured Users:**
{% for user in mongodb_users %}
### User: {{ user.user | default('Unknown') }}
- **Database:** {{ user.db | default('Unknown') }}
- **Roles:** {{ user.roles | map(attribute='role') | list | join(', ') if user.roles is defined else 'None' }}
{% endfor %}

**Connection Test Results:**
- **admin:** {{ 'PASSED ✓' if (mongodb_ping_admin is defined and mongodb_ping_admin.rc == 0) else 'FAILED ✗' }}
- **itential:** {{ 'PASSED ✓' if (mongodb_user_itential_ping is defined and mongodb_user_itential_ping.rc == 0) else 'FAILED ✗' }}
{% else %}
No users found or unable to retrieve user list
{% endif %}

---

## Replica Set Configuration

{% if mongodb_replset_name.stdout is defined and mongodb_replset_name.stdout != "" %}
**Replica Set Name:** {{ mongodb_replset_name.stdout }}

{% if mongodb_replset_status is defined and mongodb_replset_status.rc == 0 %}
{% set rs_status = mongodb_replset_status.stdout | from_json %}
### Replica Set Status
- **Set Name:** {{ rs_status.set | default('Unknown') }}
{% if rs_status.date is defined %}
- **Date:** {{ rs_status.date }}
{% endif %}
- **My State:** {{ rs_status.myState | default('Unknown') }}

### Members:
{% if rs_status.members is defined %}
{% for member in rs_status.members %}
#### {{ member.name | default('Unknown') }}
- **State:** {{ member.stateStr | default('Unknown') }}
- **Health:** {{ member.health | default('Unknown') }}
- **Uptime:** {{ member.uptime | default('Unknown') }} seconds
{% if member.optime is defined and member.optime.ts is defined %}
- **Optime:** {{ member.optime.ts }}
{% endif %}
{% if member.stateStr == 'PRIMARY' %}
- **Role:** PRIMARY ⭐
{% elif member.stateStr == 'SECONDARY' %}
- **Role:** SECONDARY
{% endif %}

{% endfor %}
{% endif %}
{% endif %}

{% if mongodb_replset_config is defined and mongodb_replset_config.rc == 0 %}
{% set rs_config = mongodb_replset_config.stdout | from_json %}
### Replica Set Configuration
- **Config Version:** {{ rs_config.version | default('Unknown') }}
- **Protocol Version:** {{ rs_config.protocolVersion | default('Unknown') }}

**Settings:**
- **Heartbeat Timeout:** {{ rs_config.settings.heartbeatTimeoutSecs | default('Unknown') }} seconds
- **Election Timeout:** {{ rs_config.settings.electionTimeoutMillis | default('Unknown') }} ms
- **Catchup Timeout:** {{ rs_config.settings.catchUpTimeoutMillis | default('Unknown') }} ms
{% if rs_config.members is defined %}
{% for member in rs_config.members %}
#### {{ member.host | default('Unknown') }}
- **arbiterOnly:** {{ member.arbiterOnly | default(false) }}
- **priority:** {{ member.priority | default(0) }}
- **hidden:** {{ member.hidden | default(false) }}
- **votes:** {{ member.votes | default(1) }}
{% endfor %}
{% endif %}
{% endif %}

{% else %}
Replica set not configured
{% endif %}

---

## Database Information

{% if mongodb_databases is defined and mongodb_databases.rc == 0 %}
{% set db_list = mongodb_databases.stdout | from_json %}
**Total Databases:** {{ db_list.databases | length if db_list.databases is defined else 0 }}
{% if db_list.totalSize is defined %}
{% if db_list.totalSize is number %}
**Total Size:** {{ (db_list.totalSize / 1024 / 1024 / 1024) | round(2) }} GB
{% else %}
**Total Size:** Unknown
{% endif %}
{% endif %}

### Databases:
{% if db_list.databases is defined %}
{% for db in db_list.databases %}
{% if db.sizeOnDisk is defined and db.sizeOnDisk is number %}
- **{{ db.name }}:** {{ (db.sizeOnDisk / 1024 / 1024) | round(2) }} MB
{% else %}
- **{{ db.name }}:** Size unknown
{% endif %}
{% endfor %}
{% endif %}
{% endif %}

---

## Server Metrics

{% if mongodb_server_status is defined and mongodb_server_status.rc == 0 %}
{% set server_status = mongodb_server_status.stdout | from_json %}

### Connections
- **Current:** {{ server_status.connections.current | default('Unknown') }}
- **Available:** {{ server_status.connections.available | default('Unknown') }}
- **Total Created:** {{ server_status.connections.totalCreated | default('Unknown') }}

### Memory
- **Resident:** {{ (server_status.mem.resident | default(0)) }} MB
- **Virtual:** {{ (server_status.mem.virtual | default(0)) }} MB

### Network
{% if server_status.network.bytesIn is defined and server_status.network.bytesIn is number %}
- **Bytes In:** {{ (server_status.network.bytesIn / 1024 / 1024) | round(2) }} MB
{% else %}
- **Bytes In:** Unknown
{% endif %}
{% if server_status.network.bytesOut is defined and server_status.network.bytesOut is number %}
- **Bytes Out:** {{ (server_status.network.bytesOut / 1024 / 1024) | round(2) }} MB
{% else %}
- **Bytes Out:** Unknown
{% endif %}
{% endif %}

---

## Recent Log Entries (Last 100 lines)

```
{{ mongodb_logs.stdout | default('Log entries not available') if mongodb_logs is defined else 'Log entries not available' }}
```

---

## Validation Summary

**Overall Status:** {{ 'PASSED ✓' if (mongodb_ping_admin is defined and mongodb_ping_admin.rc == 0 and mongodb_process is defined and mongodb_process.rc == 0) else 'FAILED ✗' }}

### Checks:

{% if mongodb_service_status is defined and mongodb_service_status.status is defined %}
- **MongoDB Service Exists:** YES ✓
- **MongoDB Service Active:** {{ mongodb_service_status.status.ActiveState | default('unknown') | upper }} {{ '✓' if mongodb_service_status.status.ActiveState == 'active' else '✗' }}
{% else %}
- **MongoDB Service Exists:** NO ✗
{% endif %}
- **MongoDB Process Running:** {{ 'YES ✓' if (mongodb_process is defined and mongodb_process.rc == 0) else 'NO ✗' }}
- **MongoDB Responding:** {{ 'YES ✓' if (mongodb_ping_admin is defined and mongodb_ping_admin.rc == 0) else 'NO ✗' }}
- **Config File Present:** {{ 'YES ✓' if (mongodb_conf_file is defined and mongodb_conf_file.stat.exists) else 'NO ✗' }}
- **Authentication Enabled:** {{ 'YES ✓' if (mongodb_auth_enabled is defined and mongodb_auth_enabled.rc == 0) else 'NO ✗' }}
{% if mongodb_tls_mode is defined and mongodb_tls_mode.rc == 0 %}
- **TLS Configured:** YES ✓
- **TLS Connection:** {{ 'SUCCESS ✓' if (mongodb_ping_tls is defined and mongodb_ping_tls.rc == 0) else 'FAILED ✗' }}
{% else %}
- **TLS Configured:** NO ✗
{% endif %}
{% if mongodb_replset_name.stdout is defined and mongodb_replset_name.stdout != "" %}
- **Replica Set Configured:** YES ✓
- **Replica Set Status:** {{ 'OK ✓' if (mongodb_replset_status is defined and mongodb_replset_status.rc == 0) else 'FAILED ✗' }}
{% else %}
- **Replica Set Configured:** NO ✗
{% endif %}

---

**End of Report**