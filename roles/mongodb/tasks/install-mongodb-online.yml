# Copyright (c) 2024, Itential, Inc
# GNU General Public License v3.0+ (see LICENSE or https://www.gnu.org/licenses/gpl-3.0.txt)
---
- name: Install Mongo dependency packages
  ansible.builtin.dnf:
    name: "{{ mongodb_package_dependencies }}"
    state: present
    update_cache: true

# Install the mongodb repo if mongodb is not already installed
- name: Install MongoDB repo (with Oracle Linux 9 handling)
  ansible.builtin.yum_repository:
    name: "mongodb"
    description: MongoDB Repository
    baseurl: >-
      {% if ansible_facts['distribution'] == 'OracleLinux' and ansible_facts['distribution_major_version'] == '9' %}
      https://repo.mongodb.org/yum/redhat/9/mongodb-org/{{ mongodb_version }}/x86_64/
      {% else %}
      {{ mongodb_release_url }}
      {% endif %}
    enabled: true
    gpgcheck: true
    gpgkey: >-
      {% if ansible_facts['distribution'] == 'OracleLinux' and ansible_facts['distribution_major_version'] == '9' %}
      https://www.mongodb.org/static/pgp/server-{{ mongodb_version }}.asc
      {% else %}
      {{ mongodb_gpgkey_url }}
      {% endif %}
  when:
    - common_install_yum_repos | bool
    - "'mongodb-org' not in ansible_facts.packages"


# Install mongodb if mongodb is not already installed
- name: Install MongoDB packages
  ansible.builtin.dnf:
    name: "{{ mongodb_packages }}"
    state: present
  when: "'mongodb-org' not in ansible_facts.packages"
